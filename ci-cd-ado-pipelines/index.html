
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://azure.github.io/enterprise-azure-policy-as-code/ci-cd-ado-pipelines/">
      
      
        <link rel="prev" href="../ci-cd-app-registrations/">
      
      
        <link rel="next" href="../ci-cd-github-actions/">
      
      
      <link rel="icon" href="../Images/10316-icon-service-Policy.svg">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Azure DevOps Pipelines - Enterprise Policy As Code (EPAC)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-devops-pipelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Enterprise Policy As Code (EPAC)" class="md-header__button md-logo" aria-label="Enterprise Policy As Code (EPAC)" data-md-component="logo">
      
  <img src="../Images/10316-icon-service-Policy.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Enterprise Policy As Code (EPAC)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure DevOps Pipelines
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Azure/enterprise-azure-policy-as-code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../epac-implementing/" class="md-tabs__link">
          
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../settings-global-setting-file/" class="md-tabs__link">
          
  
    
  
  Settings and Desired State

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../policy-definitions/" class="md-tabs__link">
          
  
    
  
  Define Policy Resources

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../integrating-with-alz/" class="md-tabs__link">
          
  
    
  
  Azure Landing Zones

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ci-cd-overview/" class="md-tabs__link">
          
  
    
  
  CI/CD Integration

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../operational-scripts/" class="md-tabs__link">
          
  
    
  
  Operational Scripts

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Enterprise Policy As Code (EPAC)" class="md-nav__button md-logo" aria-label="Enterprise Policy As Code (EPAC)" data-md-component="logo">
      
  <img src="../Images/10316-icon-service-Policy.svg" alt="logo">

    </a>
    Enterprise Policy As Code (EPAC)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Azure/enterprise-azure-policy-as-code" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../epac-implementing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Implementing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../epac-extracting-policy-resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extracting Policy Resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../epac-forking-github-repo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forking GitHub Repo
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Settings and Desired State
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Settings and Desired State
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings-global-setting-file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Global Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings-desired-state/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Desired State
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings-dfc-assignments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DfC Assignments
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Define Policy Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Define Policy Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-definitions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Policy Definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-set-definitions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Policy Set Definitions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-assignments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Policy Assignment Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-assignments-csv-parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSV Assignment Parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-exemptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Policy Exemptions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure Landing Zones
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Azure Landing Zones
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrating-with-alz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ALZ Policy Integration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrating-with-alz-monitor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Monitor Baseline Alerts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../integrating-with-slz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sovereign Landing Zones
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    CI/CD Integration
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            CI/CD Integration
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-app-registrations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    App Registrations Setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Azure DevOps Pipelines
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Azure DevOps Pipelines
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-connections-for-azure-devops-cicd" class="md-nav__link">
    <span class="md-ellipsis">
      Service connections for Azure DevOps CI/CD
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-tenant-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Single Tenant Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Single Tenant Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-tenant-stages" class="md-nav__link">
    <span class="md-ellipsis">
      Single Tenant Stages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-tenant-service-connections-and-roles" class="md-nav__link">
    <span class="md-ellipsis">
      Single Tenant Service Connections and Roles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-tenant-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Tenant Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi Tenant Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-tenant-stages" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Tenant Stages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-tenant-service-connections-and-roles" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Tenant Service Connections and Roles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-devops-simplified-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Azure DevOps (Simplified Pipeline)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Environments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Execution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commit-to-a-feature-branch-or-a-manual-pipeline-run" class="md-nav__link">
    <span class="md-ellipsis">
      Commit to a feature branch or a manual pipeline run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-request-is-approved-and-branch-merged-into-main" class="md-nav__link">
    <span class="md-ellipsis">
      Pull Request is approved and branch merged into main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-changes" class="md-nav__link">
    <span class="md-ellipsis">
      No changes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci-cd-github-actions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub Actions
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Operational Scripts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Operational Scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scripts Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts-documenting-policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documenting Policy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts-hydration-kit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hydration Kit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../operational-scripts-reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-connections-for-azure-devops-cicd" class="md-nav__link">
    <span class="md-ellipsis">
      Service connections for Azure DevOps CI/CD
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-tenant-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Single Tenant Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Single Tenant Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-tenant-stages" class="md-nav__link">
    <span class="md-ellipsis">
      Single Tenant Stages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#single-tenant-service-connections-and-roles" class="md-nav__link">
    <span class="md-ellipsis">
      Single Tenant Service Connections and Roles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-tenant-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Tenant Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multi Tenant Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-tenant-stages" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Tenant Stages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-tenant-service-connections-and-roles" class="md-nav__link">
    <span class="md-ellipsis">
      Multi Tenant Service Connections and Roles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#azure-devops-simplified-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Azure DevOps (Simplified Pipeline)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-environments" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment Environments
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Execution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#commit-to-a-feature-branch-or-a-manual-pipeline-run" class="md-nav__link">
    <span class="md-ellipsis">
      Commit to a feature branch or a manual pipeline run
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pull-request-is-approved-and-branch-merged-into-main" class="md-nav__link">
    <span class="md-ellipsis">
      Pull Request is approved and branch merged into main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-changes" class="md-nav__link">
    <span class="md-ellipsis">
      No changes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="azure-devops-pipelines">Azure DevOps Pipelines</h1>
<p>This page covers the specifics for Azure DevOps (ADO) pipelines. It si based on a simplified GitHub Flow as documented in <a href="../ci-cd-overview/">CI/CD Overview</a></p>
<p>Previously <a href="../ci-cd-app-registrations/">setup App Registrations</a> are a pre-requisite.</p>
<p>This repository contains starter pipelines</p>
<ul>
<li>Azure DevOps (Single Tenant)</li>
<li>Azure DevOps (Multi Tenant)</li>
<li>Azure DevOps (Simplified)</li>
</ul>
<h2 id="service-connections-for-azure-devops-cicd">Service connections for Azure DevOps CI/CD</h2>
<p>Create ADO service connections for each of the previously created <a href="../ci-cd-app-registrations/">App Registrations</a>. You will need to retrieve the client id and create a client secret or authenticate with a X509 certificate configured for the SPN.</p>
<p>When creating a Service Connection in Azure DevOps you can set up the service connections on a Subscription or a Management Group scope level. If you are using subscriptions to simulate a hierarchy during EPAC development, configure the service connection(s) scope level as <strong>Subscription</strong>. When creating a Service Connections for management groups (any EPAC environments) Deployment and EPAC Role Assignment the service connection scope level is <strong>Management Group</strong>.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Subscription scope level</th>
<th style="text-align: center;">Management Group scope level</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><img alt="image" src="../Images/azdoServiceConnectionSubConf.png" /></td>
<td style="text-align: center;"><img alt="image" src="../Images/azdoServiceConnectionMGConf.png" /></td>
</tr>
</tbody>
</table>
<h2 id="single-tenant-pipeline">Single Tenant Pipeline</h2>
<h3 id="single-tenant-stages">Single Tenant Stages</h3>
<table>
<thead>
<tr>
<th>Stage</th>
<th>Purpose</th>
<th>Trigger</th>
<th>Scripts</th>
</tr>
</thead>
<tbody>
<tr>
<td>devStage</td>
<td>Feature branch DEV environment build, deploy and test</td>
<td>CI, Manual</td>
<td>Build-DeploymentPlans <br> Deploy-PolicyPlan <br/> Deploy-RolesPlan</td>
</tr>
<tr>
<td>tenantPlanFeatureStage</td>
<td>Feature branch based plan for prod deployment</td>
<td>CI, Manual</td>
<td>Build-DeploymentPlans</td>
</tr>
<tr>
<td>tenantPlanMainStage</td>
<td>Main branch based plan for prod deployment</td>
<td>PR Merged, Manual</td>
<td>Build-DeploymentPlans</td>
</tr>
<tr>
<td>tenantDeployStage</td>
<td>Deploy Policies defined by Main branch based plan</td>
<td>Prod stage approved</td>
<td>Deploy-PolicyPlan</td>
</tr>
<tr>
<td>tenantRolesStage</td>
<td>Assign roles defined by Main branch based plan</td>
<td>Role stage approved</td>
<td>Deploy-RolesPlan</td>
</tr>
</tbody>
</table>
<h3 id="single-tenant-service-connections-and-roles">Single Tenant Service Connections and Roles</h3>
<p>Create Service Principals and associated service connections in Azure DevOps or the equivalent in your CI/CD tool. The SPNs require the following roles to adhere to the least privilege principle. If you have a single tenant, remove the last column and rows with connections ending in "-2".  If a pacEnvironment in any of these stages is deploying to a lighthouse managed tenant and additionalRoleAssignemnts are to be used, ABAC assignments will need to be granted to the service principal at all remote scopes granting User Access Administrator for any roles that may need to be granted via additionalRoleAssignments.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Connection</th>
<th style="text-align: left;">Stages</th>
<th style="text-align: left;">MG: epac-dev-mg</th>
<th style="text-align: left;">MG: Tenant Root</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">sc-pac-dev</td>
<td style="text-align: left;">devStage</td>
<td style="text-align: left;">Owner <br/> MS Graph Permissions</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-plan</td>
<td style="text-align: left;">tenantPlanFeatureStage <br/> tenantPlanMainStage</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">EPAC Policy Reader <br/> MS Graph Permissions</td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-prod</td>
<td style="text-align: left;">tenantDeployStage</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Policy Contributor</td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-roles</td>
<td style="text-align: left;">tenantRolesStage-1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">User Access Administrator <br/> MS Graph Permissions</td>
</tr>
</tbody>
</table>
<h2 id="multi-tenant-pipeline">Multi Tenant Pipeline</h2>
<h3 id="multi-tenant-stages">Multi Tenant Stages</h3>
<table>
<thead>
<tr>
<th>Stage</th>
<th>Purpose</th>
<th>Trigger</th>
<th>Scripts</th>
</tr>
</thead>
<tbody>
<tr>
<td>devStage</td>
<td>Feature branch EPAC DEV environment build, deploy and test</td>
<td>CI, Manual</td>
<td>Build-DeploymentPlans <br> Deploy-PolicyPlan <br/> Deploy-RolesPlan</td>
</tr>
<tr>
<td>tenantPlanFeatureStage-1</td>
<td>Feature branch based plan for prod deployment (tenant 1)</td>
<td>CI, Manual</td>
<td>Build-DeploymentPlans</td>
</tr>
<tr>
<td>tenantPlanFeatureStage-2</td>
<td>Feature branch based plan for prod deployment (tenant 2)</td>
<td>CI, Manual</td>
<td>Build-DeploymentPlans</td>
</tr>
<tr>
<td>completedFeature</td>
<td>Empty stage to complete feature branch</td>
<td>None</td>
<td>None</td>
</tr>
<tr>
<td>tenantPlanMainStage-1</td>
<td>Main branch based plan for prod deployment (tenant 1)</td>
<td>PR Merged, Manual</td>
<td>Build-DeploymentPlans</td>
</tr>
<tr>
<td>tenantDeployStage-1</td>
<td>Deploy Policies defined by Main branch based plan (tenant 1)</td>
<td>Prod stage approved</td>
<td>Deploy-PolicyPlan</td>
</tr>
<tr>
<td>tenantRolesStage-1</td>
<td>Assign roles defined by Main branch based plan (tenant 1)</td>
<td>Role stage approved</td>
<td>Deploy-RolesPlan</td>
</tr>
<tr>
<td>tenantPlanMainStage-2</td>
<td>Main branch based plan for prod deployment (tenant 2)</td>
<td>PR Merged, Manual</td>
<td>Build-DeploymentPlans</td>
</tr>
<tr>
<td>tenantDeployStage-2</td>
<td>Deploy Policies defined by Main branch based plan (tenant 2)</td>
<td>Prod stage approved</td>
<td>Deploy-PolicyPlan</td>
</tr>
<tr>
<td>tenantRolesStage-2</td>
<td>Assign roles defined by Main branch based plan (tenant 2)</td>
<td>Role stage approved</td>
<td>Deploy-RolesPlan</td>
</tr>
</tbody>
</table>
<h3 id="multi-tenant-service-connections-and-roles">Multi Tenant Service Connections and Roles</h3>
<p>Create Service Principals and associated service connections in Azure DevOps or the equivalent in your CI/CD tool. The SPNs require the following roles to adhere to the least privilege principle. If you have a single tenant, remove the last column and rows with connections ending in "-2".  If a pacEnvironment in any of these stages is deploying to a lighthouse managed tenant and additionalRoleAssignemnts are to be used, ABAC assignments will need to be granted to the service principal at all remote scopes granting User Access Administrator for any roles that may need to be granted via additionalRoleAssignments.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Connection</th>
<th style="text-align: left;">Stages</th>
<th style="text-align: left;">MG: epac-dev-mg</th>
<th style="text-align: left;">MG: Tenant 1 Root</th>
<th style="text-align: left;">MG: Tenant 2 Root</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">sc-pac-dev</td>
<td style="text-align: left;">devStage</td>
<td style="text-align: left;">Owner <br/> MS Graph Permissions</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-plan-1</td>
<td style="text-align: left;">tenantPlanFeatureStage-1 <br/> tenantPlanMainStage-1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">EPAC Policy Reader <br/> MS Graph Permissions</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-plan-2</td>
<td style="text-align: left;">tenantPlanFeatureStage-2 <br/> tenantPlanMainStage-2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">EPAC Policy Reader <br/> MS Graph Permissions</td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-prod-1</td>
<td style="text-align: left;">tenantDeployStage-1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Policy Contributor</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-prod-2</td>
<td style="text-align: left;">tenantDeployStage-2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Policy Contributor</td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-roles-1</td>
<td style="text-align: left;">tenantRolesStage-1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">User Access Administrator</td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">sc-pac-roles-2</td>
<td style="text-align: left;">tenantRolesStage-2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">User Access Administrator</td>
</tr>
<tr>
<td style="text-align: left;">none</td>
<td style="text-align: left;">completedPlanFeatureStage</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
<h2 id="azure-devops-simplified-pipeline">Azure DevOps (Simplified Pipeline)</h2>
<p>If you have less complex requirements for a pipeline deployment using Azure DevOps you can utilize the <code>simplified-pipeline.yaml</code> file and the <code>templates</code> folder in the <code>StarterKit</code> folder to quickly get started in Azure Pipelines.</p>
<p>This template requires the creation of two environments in Azure Pipelines and can easily have approvals added for deployment control.</p>
<h2 id="deployment-environments">Deployment Environments</h2>
<p>Create distinct ADO environment to configure approval gates. Refer to the following documentation:  <a href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/environments?view=azure-devops">https://docs.microsoft.com/en-us/azure/devops/pipelines/process/environments?view=azure-devops</a></p>
<h2 id="pipeline-execution">Pipeline Execution</h2>
<p>In Azure Devops pipelines the following happens. Your CI/CD tools will display progress differently.</p>
<h3 id="commit-to-a-feature-branch-or-a-manual-pipeline-run"><code>Commit</code> to a feature branch or a manual pipeline run</h3>
<ul>
<li>Stage devStage to deploy Policies, Policy Sets and Policy Assignments to the PAC DEV environment.</li>
<li>Calculates the plan for PROD environment deployment based on the Feature branch.</li>
<li>This plan is never executed. Instead the logs and if desired the artifact generated are used by the developer to verify the definition files and to determine if the code is ready for a Pull Request.</li>
<li>The PR approver(s) will use the same input plus the source code changes to decide the PR approval or rejection.</li>
</ul>
<p><img alt="image.png" src="../Images/feature-run.png" /></p>
<p>Detail view:</p>
<p><img alt="image.png" src="../Images/feature-run-details.png" /></p>
<h3 id="pull-request-is-approved-and-branch-merged-into-main"><code>Pull Request</code> is approved and branch merged into main</h3>
<ul>
<li>Calculates the plan for PROD environment deployment based on the merged Main branch.</li>
<li>The pipeline stops for PROD gate(s) approval at this time.</li>
<li>The logs and if desired the artifacts generated are used by the PROD gate(s) approver(s) to decide on the PROD stage approval(s) or rejection(s).</li>
<li><img alt="image.png" src="../Images/prod-approval.png" /></li>
<li><img alt="image.png" src="../Images/prod-approval-dialog.png" /></li>
<li>After the approval deployments to PROD will begin.</li>
<li>Optional a second approval before role assignments is required.</li>
<li><img alt="image.png" src="../Images/prod-complete.png" /></li>
<li>After the ntire run the overview page looks like this:</li>
<li><img alt="image.png" src="../Images/pipeline-runs.png" /></li>
</ul>
<h3 id="no-changes">No changes</h3>
<ul>
<li>Deployment steps and stages are skipped. Skipped stages do not need approvals.</li>
<li><img alt="image.png" src="../Images/prod-no-changes.png" /></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.indexes", {"navigation.sections": {"level": 1}}, "navigation.tabs", "navigation.tabs.sticky", "content.code.annotate", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>